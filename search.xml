<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>非线性优化1--高斯牛顿法</title>
      <link href="2020/11/12/%E9%9D%9E%E7%BA%BF%E6%80%A7%E4%BC%98%E5%8C%961%E2%80%94%E2%80%94%E9%AB%98%E6%96%AF%E7%89%9B%E9%A1%BF%E6%B3%95/"/>
      <url>2020/11/12/%E9%9D%9E%E7%BA%BF%E6%80%A7%E4%BC%98%E5%8C%961%E2%80%94%E2%80%94%E9%AB%98%E6%96%AF%E7%89%9B%E9%A1%BF%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<p>高斯牛顿法的推倒与应用实例。</p><a id="more"></a><h1 id="非线性优化1高斯牛顿法">非线性优化1——高斯牛顿法</h1><h2 id="推导">推导</h2><p>​ 假设观测到 <span class="math inline">\(\mathrm{N}\)</span> 个数据点 <span class="math inline">\(\left\{\left(x_{1}, y_{1}\right),\left(x_{2}, y_{2}\right), \ldots,\left(x_{N}, y_{N}\right)\right\},\)</span> 其中 <span class="math inline">\(x \in \mathbb{R}^{M}\)</span> 。希望找到包含 <span class="math inline">\(\mathrm{M}\)</span> 个参数的非线性函数 <span class="math inline">\(f\left(x, a_{1}, a_{2}, \ldots, a_{M}\right),\)</span> 拟合上述N个数据点。</p><p>​ 为了方便书写, 记: <span class="math inline">\(\quad f_{1}(\mathbf{a})=f\left(x_{1}, a_{1}, \ldots a_{M}\right)_{\circ}\)</span> 则最小二乘的目标函数为: <span class="math display">\[\varepsilon(\mathbf{a})=\sum_{i=1}^{N}\left\|f_{i}(\mathbf{a})-y_{i}\right\|^{2} \tag{1}\]</span> ​ 我们需要找到 <span class="math inline">\(\mathbf{a}=\left[a_{1}, a_{2}, \ldots, a_{M}\right]^{T},\)</span> 使得(1) 的值最小。将 (1) 对 <span class="math inline">\(\mathbf{a}_{j}\)</span> 求导: <span class="math display">\[\frac{\partial \varepsilon(\mathbf{a})}{a_{j}}=\sum_{i=1}^{N} 2\left(f_{i}(\mathbf{a})-y_{i}\right) \cdot \frac{\partial f_{i}(\mathbf{a})}{\partial a_{j}} \tag{2}\]</span></p><p>​ 因此可得<span class="math inline">\(\varepsilon(\mathbf{a})\)</span>的梯度为：<span class="math inline">\(\nabla \varepsilon(\mathbf{a}) =\left[\frac{\partial \varepsilon(\mathbf{a})}{a_{1}}, \frac{\partial \varepsilon(\mathbf{a})}{a_{2}}, \ldots, \frac{\partial \varepsilon(\mathbf{a})}{a_{M}}\right]^{T}\)</span>.</p><p><span class="math display">\[\nabla \varepsilon(\mathbf{a}) = \left[\begin{array}{cccc}\frac{\partial f_{1}(\mathbf{a})}{\partial a_{1}} &amp; \frac{\partial f_{2}(\mathbf{a})}{\partial a_{1}} &amp; \cdots &amp; \frac{\partial f_{N}(\mathbf{a})}{\partial a_{1}} \\\frac{\partial f_{1}(\mathbf{a})}{\partial a_{2}} &amp; \frac{\partial f_{2}(\mathbf{a})}{\partial a_{2}} &amp; \cdots &amp; \frac{\partial f_{N}(\mathbf{a})}{\partial a_{2}} \\\vdots &amp; \vdots &amp; \ddots &amp; \vdots \\\frac{\partial f_{1}(\mathbf{a})}{\partial a_{M}} &amp; \frac{\partial f_{2}(\mathbf{a})}{\partial a_{2}} &amp; \cdots &amp; \frac{\partial f_{N}(\mathbf{a})}{\partial a_{M}}\end{array}\right]\times\left[\begin{array}{cccc}f_{1}(\mathbf{a})-y_{1} \\f_{2}(\mathbf{a})-y_{2} \\\vdots \\f_{N}(\mathbf{a})-y_{N}\end{array}\right]\]</span></p><p>​ 且有：</p><p><span class="math display">\[\mathbf{J}_i = \left[\frac{\partial f_{i}(\mathbf{a})}{\partial a_{1}}, \frac{\partial f_{i}(\mathbf{a})}{\partial a_{2}}, \ldots, \frac{\partial f_{i}(\mathbf{a})}{\partial a_{M}}\right]^{T} \mathbf{r}=\left[\begin{array}{c}f_{1}(\mathbf{a})-y_{1} \\f_{2}(\mathbf{a})-y_{2} \\\vdots f_{N}(\mathbf{a})-y_{N}\end{array}\right]\\\]</span> <span class="math display">\[\mathbf{J} = \left[\begin{array}{cccc}\frac{\partial f_{1}(\mathbf{a})}{\partial a_{1}} &amp; \frac{\partial f_{2}(\mathbf{a})}{\partial a_{1}} &amp; \cdots &amp; \frac{\partial f_{N}(\mathbf{a})}{\partial a_{1}} \\\frac{\partial f_{1}(\mathbf{a})}{\partial a_{2}} &amp; \frac{\partial f_{2}(\mathbf{a})}{\partial a_{2}} &amp; \cdots &amp; \frac{\partial f_{N}(\mathbf{a})}{\partial a_{2}} \\\vdots &amp; \vdots &amp; \ddots &amp; \vdots \\\frac{\partial f_{1}(\mathbf{a})}{\partial a_{M}} &amp; \frac{\partial f_{2}(\mathbf{a})}{\partial a_{2}} &amp; \cdots &amp; \frac{\partial f_{N}(\mathbf{a})}{\partial a_{M}}\end{array}\right] = \left[\mathbf{J}_1, \mathbf{J}_2, \ldots, \mathbf{J}_N\right]^{T}\\\]</span></p><p>​ 因此写成向量形式有： <span class="math display">\[\nabla \varepsilon(\mathbf{a})=2 \mathbf{J}^{}\left[\begin{array}{c}\left(f_{1}(\mathbf{a})-y_{1}\right) \\\vdots \\\left(f_{N}(\mathbf{a})-y_{N}\right)\end{array}\right]=2 \mathbf{J}^{} \cdot(\vec{f}(\mathbf{a})-\vec{y})\]</span> ​ <strong>根据迭代方法找到<span class="math inline">\(\mathbf{a}_{n+1}\)</span>使得上式等于0，因此有</strong>： <span class="math display">\[\begin{aligned}\nabla \varepsilon\left(\mathbf{a}_{n+1}\right) &amp;=2 \mathbf{J}^{}\left(\vec{f}\left(\mathbf{a}_{n+1}\right)-\vec{y}\right) \\&amp; \approx 2 \mathbf{J}^{}\left(\vec{f}\left(\mathbf{a}_{n}\right)+\mathbf{J}^{T} \cdot\left(\mathbf{a}_{n+1}-\mathbf{a}_{n}\right)-\vec{y}\right)=0\end{aligned}\]</span> ​ 对上式整理可得： <span class="math display">\[\mathbf{a}_{n+1}=\mathbf{a}_{n}-\left(\mathbf{JJ^{T}} \right)^{-1} \mathbf J \cdot \mathbf{r} \\\underbrace{\mathbf{JJ^{T}}}_{\mathbf H}\Delta \mathbf{a} = \underbrace{\mathbf J \cdot \mathbf{r}}_{\mathbf{g}} \tag{3}\]</span> ​ 式(3)即是关于<span class="math inline">\(\Delta a\)</span>的线性方程组，成为<strong>增量方程</strong>。对比牛顿法，高斯牛顿法采用<span class="math inline">\(\mathbf{JJ^{T}}\)</span>作为<span class="math inline">\(\mathbf{H}\)</span>矩阵的近似，简化了海森矩阵的计算过程。同时将<span class="math inline">\(\mathbf{H}\)</span>矩阵展开后，可分解为各步<span class="math inline">\(\mathbf{J}_i\)</span>计算而得： <span class="math display">\[\mathbf H =\mathbf{JJ^{T}} = \sum_{i=1}^{N}\mathbf{J}_i\mathbf{J}_i^T\]</span></p><h2 id="步骤">步骤</h2><ol type="1"><li>给定初始值<span class="math inline">\(\mathbf a_0\)</span></li><li>对于第k次迭代，求解出当前的雅可比矩阵<span class="math inline">\(\mathbf J\)</span>以及残差<span class="math inline">\(\mathbf r\)</span>.</li><li>根据(3)式，求解增量方程<span class="math inline">\(\Delta \mathbf a\)</span></li><li>如果<span class="math inline">\(\Delta \mathbf a\)</span>足够小，则停止。否则继续迭代。</li></ol><h2 id="实例">实例</h2><figure><img src="https://tuchuang-1998.oss-accelerate.aliyuncs.com/Picgo/image-20201112100800405.png" class="lazyload" data-srcset="https://tuchuang-1998.oss-accelerate.aliyuncs.com/Picgo/image-20201112100800405.png" srcset="data:image/png;base64,666" alt="图1" /><figcaption>图1</figcaption></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 开始Gauss-Newton迭代</span></span><br><span class="line"><span class="keyword">int</span> iterations = <span class="number">100</span>;    <span class="comment">// 迭代次数</span></span><br><span class="line"><span class="keyword">double</span> cost = <span class="number">0</span>, lastCost = <span class="number">0</span>;  <span class="comment">// 本次迭代的cost和上一次迭代的cost</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> iter = <span class="number">0</span>; iter &lt; iterations; iter++) &#123;</span><br><span class="line"></span><br><span class="line">    Matrix3d H = Matrix3d::Zero();             <span class="comment">// Hessian = J^T J in Gauss-Newton</span></span><br><span class="line">    Vector3d b = Vector3d::Zero();             <span class="comment">// bias</span></span><br><span class="line">    cost = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++) &#123;</span><br><span class="line">        <span class="keyword">double</span> xi = x_data[i], yi = y_data[i];  <span class="comment">// 第i个数据点</span></span><br><span class="line">        <span class="comment">// start your code here</span></span><br><span class="line">        <span class="keyword">double</span> error = <span class="number">0</span>;   <span class="comment">// 第i个数据点的计算误差</span></span><br><span class="line">        error = yi - <span class="built_in">exp</span>(ae * xi * xi + be * xi + ce);; <span class="comment">// 填写计算error的表达式</span></span><br><span class="line">        Vector3d J; <span class="comment">// 雅可比矩阵</span></span><br><span class="line">        J[<span class="number">0</span>] = -xi * xi * <span class="built_in">exp</span>(ae * xi * xi + be * xi + ce);  <span class="comment">// de/da</span></span><br><span class="line">        J[<span class="number">1</span>] = -xi * <span class="built_in">exp</span>(ae * xi * xi + be * xi + ce);  <span class="comment">// de/db</span></span><br><span class="line">        J[<span class="number">2</span>] = -<span class="built_in">exp</span>(ae * xi * xi + be * xi + ce);  <span class="comment">// de/dc</span></span><br><span class="line"></span><br><span class="line">        H += J * J.transpose(); <span class="comment">// GN近似的H</span></span><br><span class="line">        b += -error * J;</span><br><span class="line">        <span class="comment">// end your code here</span></span><br><span class="line"></span><br><span class="line">        cost += error * error;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 求解线性方程 Hx=b，建议用ldlt</span></span><br><span class="line">    <span class="comment">// start your code here</span></span><br><span class="line">    Vector3d dx = H.ldlt().solve(b);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// end your code here</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (isnan(dx[<span class="number">0</span>])) &#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;result is nan!&quot;</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (iter &gt; <span class="number">0</span> &amp;&amp; cost &gt; lastCost) &#123;</span><br><span class="line">        <span class="comment">// 误差增长了，说明近似的不够好</span></span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;cost: &quot;</span> &lt;&lt; cost &lt;&lt; <span class="string">&quot;, last cost: &quot;</span> &lt;&lt; lastCost &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 更新abc估计值</span></span><br><span class="line">    ae += dx[<span class="number">0</span>];</span><br><span class="line">    be += dx[<span class="number">1</span>];</span><br><span class="line">    ce += dx[<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line">    lastCost = cost;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">&quot;第&quot;</span>&lt;&lt;iter&lt;&lt;<span class="string">&quot;次迭代结果&quot;</span>&lt;&lt;<span class="string">&quot;    a:&quot;</span>&lt;&lt;ae&lt;&lt;<span class="string">&quot;    b:&quot;</span>&lt;&lt;be&lt;&lt;<span class="string">&quot;    c:&quot;</span>&lt;&lt;ce&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    <span class="comment">//        cout &lt;&lt; &quot;total cost: &quot; &lt;&lt; cost &lt;&lt; endl;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="1970/01/01/hello-world/"/>
      <url>1970/01/01/hello-world/</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="quick-start">Quick Start</h2><h3 id="create-a-new-post">Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="run-server">Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="generate-static-files">Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="deploy-to-remote-sites">Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
